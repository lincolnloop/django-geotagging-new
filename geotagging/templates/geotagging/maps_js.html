    <script type="text/javascript">
        var map = new $$.Map({
            id: "{{ map_id }}",
        })
        $$.maps.add(map);

        {% for layer in layers %}
        map.collection.add(new $$.Layer({
            title: "{{ layer.name }}",
            id: "{{ layer.name }}",
            collection: new $$.SpotCollection([
               {% for spot in layer.items %}
               {
                    id: "{% if spot.object %}{{ spot.object.pk }}{% else %}{{ forloop.counter }}{% endif %}",
                    lng: {{ spot.point.x }},
                    lat: {{ spot.point.y }},
                    style: {{ spot.style|safe }},
                    title: "{{ spot.display }}",
                }, 
               {% endfor %}
            ])
        }));
        {% endfor %}
    </script>
